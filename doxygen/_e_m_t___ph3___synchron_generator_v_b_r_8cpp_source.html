<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DPsim: /__w/dpsim/dpsim/models/Source/EMT/EMT_Ph3_SynchronGeneratorVBR.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">DPsim
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_1ae4179d5e953611aae20c997279e02c.html">models</a></li><li class="navelem"><a class="el" href="dir_6642d0c0e17bb21ce02cc30a0cbdeefa.html">Source</a></li><li class="navelem"><a class="el" href="dir_16d9b3a9ae7f3c7a39aa9d0e18741b20.html">EMT</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">EMT_Ph3_SynchronGeneratorVBR.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/* Copyright 2017-2021 Institute for Automation of Complex Power Systems,</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> *                     EONERC, RWTH Aachen University</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> * This Source Code Form is subject to the terms of the Mozilla Public</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> * License, v. 2.0. If a copy of the MPL was not distributed with this</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> * file, You can obtain one at https://mozilla.org/MPL/2.0/.</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> *********************************************************************************/</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160; </div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="preprocessor">#include &lt;cps/EMT/EMT_Ph3_SynchronGeneratorVBR.h&gt;</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160; </div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="keyword">using namespace </span>CPS;</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160; </div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">// !!! TODO:    Adaptions to use in EMT_Ph3 models phase-to-ground peak variables</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">// !!!          with initialization from phase-to-phase RMS variables</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160; </div>
<div class="line"><a name="l00016"></a><span class="lineno"><a class="line" href="class_c_p_s_1_1_e_m_t_1_1_ph3_1_1_synchron_generator_v_b_r.html#a1416089cf28f20454f387b89cb7c3327">   16</a></span>&#160;<a class="code" href="class_c_p_s_1_1_e_m_t_1_1_ph3_1_1_synchron_generator_v_b_r.html#a1416089cf28f20454f387b89cb7c3327">EMT::Ph3::SynchronGeneratorVBR::SynchronGeneratorVBR</a>(String uid, String name, Logger::Level logLevel)</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;    : <a class="code" href="class_c_p_s_1_1_sim_power_comp.html">SimPowerComp</a>&lt;Real&gt;(uid, name, logLevel) {</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;    mPhaseType = PhaseType::ABC;</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;    setTerminalNumber(1);</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;    <a class="code" href="class_c_p_s_1_1_sim_power_comp.html#a894f2d211d03df0cffdc797e8a07342d">mIntfVoltage</a> = Matrix::Zero(3,1);</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;    <a class="code" href="class_c_p_s_1_1_sim_power_comp.html#ac8a46a0ec79c84c3b2bf0617f14f60ee">mIntfCurrent</a> = Matrix::Zero(3,1);</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160; </div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;    addAttribute&lt;Real&gt;(<span class="stringliteral">&quot;Rs&quot;</span>, &amp;<a class="code" href="class_c_p_s_1_1_base_1_1_synchron_generator.html#a0131de687f070c11ca16705c36c78ad0">mRs</a>, Flags::read | Flags::write);</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;    addAttribute&lt;Real&gt;(<span class="stringliteral">&quot;Ll&quot;</span>, &amp;<a class="code" href="class_c_p_s_1_1_base_1_1_synchron_generator.html#a1990c4c829f7a336ab21e1ef856415b8">mLl</a>, Flags::read | Flags::write);</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;    addAttribute&lt;Real&gt;(<span class="stringliteral">&quot;Ld&quot;</span>, &amp;<a class="code" href="class_c_p_s_1_1_base_1_1_synchron_generator.html#a8384c3c3a5ec8e8f9b142591b4616404">mLd</a>, Flags::read | Flags::write);</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;    addAttribute&lt;Real&gt;(<span class="stringliteral">&quot;Lq&quot;</span>, &amp;<a class="code" href="class_c_p_s_1_1_base_1_1_synchron_generator.html#affddef77e865aefe796c44cd44f599e1">mLq</a>, Flags::read | Flags::write);</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160; </div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;    addAttribute&lt;Real&gt;(<span class="stringliteral">&quot;Ld_t&quot;</span>, &amp;<a class="code" href="class_c_p_s_1_1_base_1_1_synchron_generator.html#a8d4962c6494e6b5fe9d924c1f83e3f94">mLd_t</a>, Flags::read | Flags::write);</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    addAttribute&lt;Real&gt;(<span class="stringliteral">&quot;Ld_s&quot;</span>, &amp;<a class="code" href="class_c_p_s_1_1_base_1_1_synchron_generator.html#acc1f4ae7a27b9b7e1a913666538ec827">mLd_s</a>, Flags::read | Flags::write);</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    addAttribute&lt;Real&gt;(<span class="stringliteral">&quot;Lq_t&quot;</span>, &amp;<a class="code" href="class_c_p_s_1_1_base_1_1_synchron_generator.html#aaf2f8a4f1ca955da34b72479fed773c4">mLq_t</a>, Flags::read | Flags::write);</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    addAttribute&lt;Real&gt;(<span class="stringliteral">&quot;Lq_s&quot;</span>, &amp;<a class="code" href="class_c_p_s_1_1_base_1_1_synchron_generator.html#a7a0d4f28acac80c5df24e96cace9d6e6">mLq_s</a>, Flags::read | Flags::write);</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160; </div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    addAttribute&lt;Real&gt;(<span class="stringliteral">&quot;Td0_t&quot;</span>, &amp;<a class="code" href="class_c_p_s_1_1_base_1_1_synchron_generator.html#afe1e370e0f7fc0c592e27ab2590ce966">mTd0_t</a>, Flags::read | Flags::write);</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    addAttribute&lt;Real&gt;(<span class="stringliteral">&quot;Td0_s&quot;</span>, &amp;<a class="code" href="class_c_p_s_1_1_base_1_1_synchron_generator.html#a7832f483d62475baad29a452d40d84a0">mTd0_s</a>, Flags::read | Flags::write);</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    addAttribute&lt;Real&gt;(<span class="stringliteral">&quot;Tq0_t&quot;</span>, &amp;<a class="code" href="class_c_p_s_1_1_base_1_1_synchron_generator.html#ac5b6c51176c2caa4b27defdcf2b621ca">mTq0_t</a>, Flags::read | Flags::write);</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    addAttribute&lt;Real&gt;(<span class="stringliteral">&quot;Tq0_s&quot;</span>, &amp;<a class="code" href="class_c_p_s_1_1_base_1_1_synchron_generator.html#ada5852c6a374ccc5fde46251aa6a33fd">mTq0_s</a>, Flags::read | Flags::write);</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160; </div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    addAttribute&lt;Real&gt;(<span class="stringliteral">&quot;w_r&quot;</span>, &amp;<a class="code" href="class_c_p_s_1_1_base_1_1_synchron_generator.html#a8c650f148ffedc2f4396f6f4cb010217">mOmMech</a>, Flags::read);</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    addAttribute&lt;Real&gt;(<span class="stringliteral">&quot;delta_r&quot;</span>, &amp;<a class="code" href="class_c_p_s_1_1_base_1_1_synchron_generator.html#aa8b744d3e00c276a53dd7936cbc1e494">mDelta</a>, Flags::read);</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160; </div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    addAttribute&lt;Real&gt;(<span class="stringliteral">&quot;T_e&quot;</span>, &amp;<a class="code" href="class_c_p_s_1_1_base_1_1_synchron_generator.html#aeff43e395455097872843d8cac5fb12f">mElecTorque</a>, Flags::read);</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    addAttribute&lt;Real&gt;(<span class="stringliteral">&quot;T_m&quot;</span>, &amp;<a class="code" href="class_c_p_s_1_1_base_1_1_synchron_generator.html#aa53d7a62e020b76e38dbd047e2a7847d">mMechTorque</a>, Flags::read);</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    </div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;}</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160; </div>
<div class="line"><a name="l00046"></a><span class="lineno"><a class="line" href="class_c_p_s_1_1_e_m_t_1_1_ph3_1_1_synchron_generator_v_b_r.html#accbda932610e68408e839b513ad313ba">   46</a></span>&#160;<a class="code" href="class_c_p_s_1_1_e_m_t_1_1_ph3_1_1_synchron_generator_v_b_r.html#a1416089cf28f20454f387b89cb7c3327">EMT::Ph3::SynchronGeneratorVBR::SynchronGeneratorVBR</a>(String name, Logger::Level logLevel)</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    : <a class="code" href="class_c_p_s_1_1_e_m_t_1_1_ph3_1_1_synchron_generator_v_b_r.html">SynchronGeneratorVBR</a>(name, name, logLevel) {</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;}</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160; </div>
<div class="line"><a name="l00050"></a><span class="lineno"><a class="line" href="class_c_p_s_1_1_e_m_t_1_1_ph3_1_1_synchron_generator_v_b_r.html#a4a4715b6aee21d722c24c7e57876aac8">   50</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_p_s_1_1_e_m_t_1_1_ph3_1_1_synchron_generator_v_b_r.html#a4a4715b6aee21d722c24c7e57876aac8">EMT::Ph3::SynchronGeneratorVBR::setBaseAndOperationalPerUnitParameters</a>(</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    Real nomPower, Real nomVolt, Real nomFreq, Int poleNumber, Real nomFieldCur,</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    Real Rs, Real Ld, Real Lq, Real Ld_t, Real Lq_t, Real Ld_s, Real Lq_s,</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    Real Ll, Real Td0_t, Real Tq0_t, Real Td0_s, Real Tq0_s, Real inertia) {</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160; </div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    <a class="code" href="class_c_p_s_1_1_base_1_1_synchron_generator.html#add6ca785d0bfbf120ffc5be2c60545b6">Base::SynchronGenerator::setBaseAndOperationalPerUnitParameters</a>(nomPower, nomVolt, nomFreq, poleNumber, nomFieldCur,</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;                                                                    Rs, Ld, Lq, Ld_t, Lq_t, Ld_s, Lq_s,</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;                                                                    Ll, Td0_t, Tq0_t, Td0_s, Tq0_s, inertia);</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160; </div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    mSLog-&gt;info(<span class="stringliteral">&quot;Set base parameters: \n&quot;</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;                <span class="stringliteral">&quot;nomPower: {:e}\nnomVolt: {:e}\nnomFreq: {:e}\n nomFieldCur: {:e}\n&quot;</span>,</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;                nomPower, nomVolt, nomFreq, nomFieldCur);</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160; </div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    mSLog-&gt;info(<span class="stringliteral">&quot;Set operational parameters in per unit: \n&quot;</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;            <span class="stringliteral">&quot;poleNumber: {:d}\ninertia: {:e}\n&quot;</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;            <span class="stringliteral">&quot;Rs: {:e}\nLd: {:e}\nLq: {:e}\nLl: {:e}\n&quot;</span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;            <span class="stringliteral">&quot;Ld_t: {:e}\nLq_t: {:e}\nLd_s: {:e}\nLq_s: {:e}\n&quot;</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;            <span class="stringliteral">&quot;Td0_t: {:e}\nTq0_t: {:e}\nTd0_s: {:e}\nTq0_s: {:e}\n&quot;</span>,</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;            poleNumber, inertia,</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;            Rs, Ld, Lq, Ll, </div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;            Ld_t, Lq_t, Ld_s, Lq_s,</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;            Td0_t, Tq0_t, Td0_s, Tq0_s);</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160; </div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    mSLog-&gt;info(<span class="stringliteral">&quot;Set fundamental parameters in per unit: \n&quot;</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;            <span class="stringliteral">&quot;Rs: {:e}\nLl: {:e}\nLmd: {:e}\nLmq: {:e}\nRfd: {:e}\nLlfd: {:e}\nRkd: {:e}\n&quot;</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;            <span class="stringliteral">&quot;Llkd: {:e}\nRkq1: {:e}\nLlkq1: {:e}\nRkq2: {:e}\nLlkq2: {:e}\n&quot;</span>,</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;            mRs, mLl, mLmd, mLmq, mRfd, mLlfd, mRkd, mLlkd, mRkq1, mLlkq1, mRkq2, mLlkq2);</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;}</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160; </div>
<div class="line"><a name="l00079"></a><span class="lineno"><a class="line" href="class_c_p_s_1_1_e_m_t_1_1_ph3_1_1_synchron_generator_v_b_r.html#a1ad23099a58fc61b4b5729288f27ee51">   79</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_p_s_1_1_e_m_t_1_1_ph3_1_1_synchron_generator_v_b_r.html#a1ad23099a58fc61b4b5729288f27ee51">EMT::Ph3::SynchronGeneratorVBR::setBaseAndFundamentalPerUnitParameters</a>(</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    Real nomPower, Real nomVolt, Real nomFreq, Int poleNumber, Real nomFieldCur,</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    Real Rs, Real Ll, Real Lmd, Real Lmq, Real Rfd, Real Llfd, Real Rkd, Real Llkd,</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    Real Rkq1, Real Llkq1, Real Rkq2, Real Llkq2, Real inertia) {</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160; </div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <a class="code" href="class_c_p_s_1_1_base_1_1_synchron_generator.html#a9ac3b83196f52f4014e8476485b38f60">Base::SynchronGenerator::setBaseAndFundamentalPerUnitParameters</a>(</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;        nomPower, nomVolt, nomFreq, nomFieldCur,</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;        poleNumber, Rs, Ll, Lmd, Lmq, Rfd, Llfd, Rkd, Llkd, Rkq1, Llkq1, Rkq2, Llkq2, inertia);</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160; </div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    mSLog-&gt;info(<span class="stringliteral">&quot;Set base and fundamental parameters in per unit: \n&quot;</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;                <span class="stringliteral">&quot;nomPower: {:e}\nnomVolt: {:e}\nnomFreq: {:e}\npoleNumber: {:d}\nnomFieldCur: {:e}\n&quot;</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;                <span class="stringliteral">&quot;Rs: {:e}\nLl: {:e}\nLmd: {:e}\nLmq: {:e}\nRfd: {:e}\nLlfd: {:e}\nRkd: {:e}\n&quot;</span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;                <span class="stringliteral">&quot;Llkd: {:e}\nRkq1: {:e}\nLlkq1: {:e}\nRkq2: {:e}\nLlkq2: {:e}\ninertia: {:e}&quot;</span>,</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;                nomPower, nomVolt, nomFreq, poleNumber, nomFieldCur,</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;                Rs, Ll, Lmd, Lmq, Rfd, Llfd, Rkd, Llkd, Rkq1, Llkq1, Rkq2, Llkq2, inertia);</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;}</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160; </div>
<div class="line"><a name="l00096"></a><span class="lineno"><a class="line" href="class_c_p_s_1_1_e_m_t_1_1_ph3_1_1_synchron_generator_v_b_r.html#ac67dd7d013f16501da61f46e8f636211">   96</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_p_s_1_1_e_m_t_1_1_ph3_1_1_synchron_generator_v_b_r.html#ac67dd7d013f16501da61f46e8f636211">EMT::Ph3::SynchronGeneratorVBR::setInitialValues</a>(Real initActivePower, Real initReactivePower,</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;            Real initTerminalVolt, Real initVoltAngle, Real initMechPower) {</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160; </div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    Base::SynchronGenerator::setInitialValues(initActivePower, initReactivePower,</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;        initTerminalVolt, initVoltAngle, initMechPower);</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160; </div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    mSLog-&gt;info(<span class="stringliteral">&quot;Set initial values: \n&quot;</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;                <span class="stringliteral">&quot;initActivePower: {:e}\ninitReactivePower: {:e}\ninitTerminalVolt: {:e}\n&quot;</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;                <span class="stringliteral">&quot;initVoltAngle: {:e} \ninitMechPower: {:e}&quot;</span>,</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;                initActivePower, initReactivePower, initTerminalVolt, </div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;                initVoltAngle, initMechPower);</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;}</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160; </div>
<div class="line"><a name="l00109"></a><span class="lineno"><a class="line" href="class_c_p_s_1_1_e_m_t_1_1_ph3_1_1_synchron_generator_v_b_r.html#a98ac6b96fbea2f1920f71de9c5bf28a2">  109</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_p_s_1_1_e_m_t_1_1_ph3_1_1_synchron_generator_v_b_r.html#a98ac6b96fbea2f1920f71de9c5bf28a2">EMT::Ph3::SynchronGeneratorVBR::initializeFromNodesAndTerminals</a>(Real frequency) {</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    <span class="keywordflow">if</span>(!mInitialValuesSet) {</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;        mSLog-&gt;info(<span class="stringliteral">&quot;--- Initialization from powerflow ---&quot;</span>);</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        </div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;        <span class="comment">// terminal powers in consumer system -&gt; convert to generator system</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;        Real activePower = -terminal(0)-&gt;singlePower().real();</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;        Real reactivePower = -terminal(0)-&gt;singlePower().imag();</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160; </div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;        <span class="comment">//  voltage magnitude in phase-to-phase RMS -&gt; convert to phase-to-ground peak expected by setInitialValues </span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;        Real voltMagnitude = RMS3PH_TO_PEAK1PH*Math::abs(initialSingleVoltage(0));</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;        </div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;        this-&gt;setInitialValues(activePower, reactivePower, voltMagnitude, Math::phase(initialSingleVoltage(0)), activePower);</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160; </div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;        mSLog-&gt;info(<span class="stringliteral">&quot;\nTerminal 0 voltage: {:s}&quot;</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;                    <span class="stringliteral">&quot;\nTerminal 0 power: {:s}&quot;</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;                    <span class="stringliteral">&quot;\n--- Initialization from powerflow finished ---&quot;</span>,</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;                    Logger::phasorToString(initialSingleVoltage(0)),</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;                    Logger::complexToString(terminal(0)-&gt;singlePower()));</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;        mSLog-&gt;flush();</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;        mSLog-&gt;info(<span class="stringliteral">&quot;Initial values already set, skipping initializeFromNodesAndTerminals.&quot;</span>);</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;        mSLog-&gt;flush();</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    }</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;}</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160; </div>
<div class="line"><a name="l00134"></a><span class="lineno"><a class="line" href="class_c_p_s_1_1_e_m_t_1_1_ph3_1_1_synchron_generator_v_b_r.html#af3f87794e24c9c5ebdc20e55ca63fb9b">  134</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_p_s_1_1_e_m_t_1_1_ph3_1_1_synchron_generator_v_b_r.html#af3f87794e24c9c5ebdc20e55ca63fb9b">EMT::Ph3::SynchronGeneratorVBR::addExciter</a>(Real Ta, Real Ka, Real Te, Real Ke, Real Tf, Real Kf, Real Tr, Real Lad, Real Rfd) {</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    <span class="comment">// mExciter = Exciter(Ta, Ka, Te, Ke, Tf, Kf, Tr, Lad, Rfd);</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <span class="comment">// mExciter.initialize(1, 1);</span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    WithExciter = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;}</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160; </div>
<div class="line"><a name="l00140"></a><span class="lineno"><a class="line" href="class_c_p_s_1_1_e_m_t_1_1_ph3_1_1_synchron_generator_v_b_r.html#a328a9aae7c94fc88e3a3b2ed1bce018a">  140</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_p_s_1_1_e_m_t_1_1_ph3_1_1_synchron_generator_v_b_r.html#a328a9aae7c94fc88e3a3b2ed1bce018a">EMT::Ph3::SynchronGeneratorVBR::addGovernor</a>(Real Ta, Real Tb, Real Tc, Real Fa, Real Fb, Real Fc, Real K, Real Tsr, Real Tsm, Real Tm_init, Real PmRef) {</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    <span class="comment">// mTurbineGovernor = TurbineGovernor(Ta, Tb, Tc, Fa, Fb, Fc, K, Tsr, Tsm);</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <span class="comment">// mTurbineGovernor.initialize(PmRef, Tm_init);</span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    WithTurbineGovernor = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;}</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160; </div>
<div class="line"><a name="l00146"></a><span class="lineno"><a class="line" href="class_c_p_s_1_1_e_m_t_1_1_ph3_1_1_synchron_generator_v_b_r.html#a309eb22ecca3d84d5f19d547a88603af">  146</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_p_s_1_1_e_m_t_1_1_ph3_1_1_synchron_generator_v_b_r.html#a309eb22ecca3d84d5f19d547a88603af">EMT::Ph3::SynchronGeneratorVBR::mnaInitialize</a>(Real omega, Real timeStep, <a class="code" href="class_c_p_s_1_1_attribute.html">Attribute&lt;Matrix&gt;::Ptr</a> leftVector) {</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    <a class="code" href="class_c_p_s_1_1_m_n_a_interface.html#a0b282e18a0e1ef7c833b23a7372a9fa7">MNAInterface::mnaInitialize</a>(omega, timeStep);</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    updateMatrixNodeIndices();</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160; </div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <span class="keywordflow">for</span> (UInt phase1Idx = 0; phase1Idx &lt; 3; ++phase1Idx)</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;        <span class="keywordflow">for</span> (UInt phase2Idx = 0; phase2Idx &lt; 3; ++phase2Idx)</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;            mVariableSystemMatrixEntries.push_back(std::make_pair&lt;UInt,UInt&gt;(matrixNodeIndex(0, phase1Idx),matrixNodeIndex(0, phase2Idx)));</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    </div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    mSLog-&gt;info(<span class="stringliteral">&quot;List of index pairs of varying matrix entries: &quot;</span>);</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> indexPair : mVariableSystemMatrixEntries)</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        mSLog-&gt;info(<span class="stringliteral">&quot;({}, {})&quot;</span>, indexPair.first, indexPair.second);</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    </div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160; </div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    mSystemOmega = omega;</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    mTimeStep = timeStep;</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160; </div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    mResistanceMat = Matrix::Zero(3, 3);</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    mResistanceMat &lt;&lt;</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;        mRs, 0, 0,</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;        0, mRs, 0,</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;        0, 0, mRs;</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160; </div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    <span class="comment">//Dynamic mutual inductances</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    mDLmd = 1. / (1. / mLmd + 1. / mLlfd + 1. / mLlkd);</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160; </div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    <span class="keywordflow">if</span> (mNumDampingWindings == 2)</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;        mDLmq = 1. / (1. / mLmq + 1. / mLlkq1 + 1. / mLlkq2);</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    {</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;        mDLmq = 1. / (1. / mLmq + 1. / mLlkq1);</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;        K1a = Matrix::Zero(2, 1);</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;        K1 = Matrix::Zero(2, 1);</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    }</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160; </div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    mLa = (mDLmq + mDLmd) / 3.;</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    mLb = (mDLmd - mDLmq) / 3.;</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160; </div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    <span class="comment">// steady state per unit initial value</span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    initPerUnitStates();</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160; </div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160; </div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    <span class="comment">// Correcting variables</span></div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    mThetaMech = mThetaMech + PI / 2;</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    mMechTorque = -mMechTorque;</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    mIq = -mIq;</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    mId = -mId;</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160; </div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <span class="comment">// Init stator currents</span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    mIq = mIsr(3,0);</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    mId = mIsr(0,0);</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    mI0 = mIsr(6,0);</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160; </div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    <span class="comment">// Init stator voltages</span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    mVq = mVsr(3,0);</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    mVd = mVsr(0,0);</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    mV0 = mVsr(6,0);</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160; </div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <span class="comment">// Init magnetizing flux linkage</span></div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    mPsikq1 = mPsisr(4,0);</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    mPsikq2 = mPsisr(5,0);</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    mPsikd = mPsisr(2,0);</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    mPsifd = mPsisr(1,0);</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    mPsimq = mPsisr(3,0);</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    mPsimd = mPsisr(0,0);</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160; </div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    mVfd = mVsr(1,0);</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160; </div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160; </div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    <span class="comment">// #### VBR Model Dynamic variables #######################################</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    CalculateAuxiliarConstants(mTimeStep*mBase_OmElec);</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160; </div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    <span class="keywordflow">if</span> (mNumDampingWindings == 2)</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;        mPsimq = mDLmq*(mPsikq1 / mLlkq1 + mPsikq2 / mLlkq2 + mIq);</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;        mPsimq = mDLmq*(mPsikq1 / mLlkq1 + mIq);</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160; </div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    mPsimd = mDLmd*(mPsifd / mLlfd + mPsikd / mLlkd + mId);</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160; </div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    mDqStatorCurrents &lt;&lt;</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;        mIq,</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;        mId;</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160; </div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    mPsikq1kq2 &lt;&lt;</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;        mPsikq1,</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;        mPsikq2;</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    mPsifdkd &lt;&lt;</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;        mPsifd,</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;        mPsikd;</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160; </div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    CalculateAuxiliarVariables();</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    K1K2 &lt;&lt; K1, K2;</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    mDVqd = K1K2*mDqStatorCurrents + h_qdr;</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    mDVq = mDVqd(0);</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    mDVd = mDVqd(1);</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160; </div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    mDVa = inverseParkTransform(mThetaMech, mDVq, mDVd, 0)(0);</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    mDVb = inverseParkTransform(mThetaMech, mDVq, mDVd, 0)(1);</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    mDVc = inverseParkTransform(mThetaMech, mDVq, mDVd, 0)(2);</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160; </div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    mDVabc &lt;&lt;</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;        mDVa,</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;        mDVb,</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;        mDVc;</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160; </div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    mVa = inverseParkTransform(mThetaMech, mVq, mVd, mV0)(0);</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    mVb = inverseParkTransform(mThetaMech, mVq, mVd, mV0)(1);</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    mVc = inverseParkTransform(mThetaMech, mVq, mVd, mV0)(2);</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160; </div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    mIa = inverseParkTransform(mThetaMech, mIq, mId, mI0)(0);</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    mIb = inverseParkTransform(mThetaMech, mIq, mId, mI0)(1);</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    mIc = inverseParkTransform(mThetaMech, mIq, mId, mI0)(2);</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160; </div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    CalculateL();</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160; </div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    mSLog-&gt;info(<span class="stringliteral">&quot;Initialize right side vector of size {}&quot;</span>, leftVector-&gt;get().rows());</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    mRightVector = Matrix::Zero(leftVector-&gt;get().rows(), 1);</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    mSLog-&gt;info(<span class="stringliteral">&quot;Component affects right side vector entries {}, {} and {}&quot;</span>, matrixNodeIndex(0,0), matrixNodeIndex(0,1), matrixNodeIndex(0,2));</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160; </div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    mMnaTasks.push_back(std::make_shared&lt;MnaPreStep&gt;(*<span class="keyword">this</span>));</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    mMnaTasks.push_back(std::make_shared&lt;MnaPostStep&gt;(*<span class="keyword">this</span>, leftVector));</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;}</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160; </div>
<div class="line"><a name="l00269"></a><span class="lineno"><a class="line" href="class_c_p_s_1_1_e_m_t_1_1_ph3_1_1_synchron_generator_v_b_r.html#a7fad15f34f10e1864ebc45eb4a4e1fe9">  269</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_p_s_1_1_e_m_t_1_1_ph3_1_1_synchron_generator_v_b_r.html#a7fad15f34f10e1864ebc45eb4a4e1fe9">EMT::Ph3::SynchronGeneratorVBR::mnaPreStep</a>(Real time, Int timeStepCount) {</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    stepInPerUnit();</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    mnaApplyRightSideVectorStamp(mRightVector);</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;}</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160; </div>
<div class="line"><a name="l00274"></a><span class="lineno"><a class="line" href="class_c_p_s_1_1_e_m_t_1_1_ph3_1_1_synchron_generator_v_b_r.html#a312263c67c8cb980dc498cf95b8576ed">  274</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_p_s_1_1_e_m_t_1_1_ph3_1_1_synchron_generator_v_b_r.html#a312263c67c8cb980dc498cf95b8576ed">EMT::Ph3::SynchronGeneratorVBR::mnaApplySystemMatrixStamp</a>(Matrix&amp; systemMatrix) {</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    <span class="keywordflow">if</span> (terminalNotGrounded(0)) {</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;        Math::addToMatrixElement(systemMatrix, matrixNodeIndex(0, 0), matrixNodeIndex(0, 0), mConductanceMat(0, 0));</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;        Math::addToMatrixElement(systemMatrix, matrixNodeIndex(0, 0), matrixNodeIndex(0, 1), mConductanceMat(0, 1));</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;        Math::addToMatrixElement(systemMatrix, matrixNodeIndex(0, 0), matrixNodeIndex(0, 2), mConductanceMat(0, 2));</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;        Math::addToMatrixElement(systemMatrix, matrixNodeIndex(0, 1), matrixNodeIndex(0, 0), mConductanceMat(1, 0));</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;        Math::addToMatrixElement(systemMatrix, matrixNodeIndex(0, 1), matrixNodeIndex(0, 1), mConductanceMat(1, 1));</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;        Math::addToMatrixElement(systemMatrix, matrixNodeIndex(0, 1), matrixNodeIndex(0, 2), mConductanceMat(1, 2));</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;        Math::addToMatrixElement(systemMatrix, matrixNodeIndex(0, 2), matrixNodeIndex(0, 0), mConductanceMat(2, 0));</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;        Math::addToMatrixElement(systemMatrix, matrixNodeIndex(0, 2), matrixNodeIndex(0, 1), mConductanceMat(2, 1));</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;        Math::addToMatrixElement(systemMatrix, matrixNodeIndex(0, 2), matrixNodeIndex(0, 2), mConductanceMat(2, 2));</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;        <span class="comment">// mSLog-&gt;info(&quot;Add {} to {}, {}&quot;, conductance, matrixNodeIndex(0,0), matrixNodeIndex(0,0));</span></div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;        <span class="comment">// mSLog-&gt;info(&quot;Add {} to {}, {}&quot;, conductance, matrixNodeIndex(0,1), matrixNodeIndex(0,1));</span></div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;        <span class="comment">// mSLog-&gt;info(&quot;Add {} to {}, {}&quot;, conductance, matrixNodeIndex(0,2), matrixNodeIndex(0,2));</span></div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    }</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;}</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160; </div>
<div class="line"><a name="l00291"></a><span class="lineno"><a class="line" href="class_c_p_s_1_1_e_m_t_1_1_ph3_1_1_synchron_generator_v_b_r.html#ad7821b407a1cb359a0a6f2ae4e340e8c">  291</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_p_s_1_1_e_m_t_1_1_ph3_1_1_synchron_generator_v_b_r.html#ad7821b407a1cb359a0a6f2ae4e340e8c">EMT::Ph3::SynchronGeneratorVBR::mnaAddPreStepDependencies</a>(AttributeBase::List &amp;prevStepDependencies, AttributeBase::List &amp;attributeDependencies, AttributeBase::List &amp;modifiedAttributes) {</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    <span class="comment">// add pre-step dependencies of component itself</span></div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    prevStepDependencies.push_back(attribute(<span class="stringliteral">&quot;i_intf&quot;</span>));</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    prevStepDependencies.push_back(attribute(<span class="stringliteral">&quot;v_intf&quot;</span>));</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    modifiedAttributes.push_back(attribute(<span class="stringliteral">&quot;right_vector&quot;</span>));</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;}</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160; </div>
<div class="line"><a name="l00298"></a><span class="lineno"><a class="line" href="class_c_p_s_1_1_e_m_t_1_1_ph3_1_1_synchron_generator_v_b_r.html#a2a5deb7005c553eb7db3cde55833505a">  298</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_p_s_1_1_e_m_t_1_1_ph3_1_1_synchron_generator_v_b_r.html#a2a5deb7005c553eb7db3cde55833505a">EMT::Ph3::SynchronGeneratorVBR::mnaApplyRightSideVectorStamp</a>(Matrix&amp; rightVector) {</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    <span class="keywordflow">if</span> (terminalNotGrounded(0)) {</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;        Math::setVectorElement(rightVector, matrixNodeIndex(0,0), mISourceEq(0));</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;        Math::setVectorElement(rightVector, matrixNodeIndex(0,1), mISourceEq(1));</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;        Math::setVectorElement(rightVector, matrixNodeIndex(0,2), mISourceEq(2));</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    }</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;}</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160; </div>
<div class="line"><a name="l00306"></a><span class="lineno"><a class="line" href="class_c_p_s_1_1_e_m_t_1_1_ph3_1_1_synchron_generator_v_b_r.html#ab0945b0c5eba9c6d5dede8f20de6df96">  306</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_p_s_1_1_e_m_t_1_1_ph3_1_1_synchron_generator_v_b_r.html#ab0945b0c5eba9c6d5dede8f20de6df96">EMT::Ph3::SynchronGeneratorVBR::stepInPerUnit</a>() {  </div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160; </div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    <span class="comment">// TODO: fix hard-coded numerical values, for this reason commented out</span></div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    <span class="comment">/* if (WithTurbineGovernor == true) {</span></div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;<span class="comment">        mMechTorque = -mTurbineGovernor.step(mOmMech, 1, 300e6 / 555e6, mTimeStep);</span></div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;<span class="comment">    }*/</span></div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160; </div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    <span class="comment">// Estimate mechanical variables with euler</span></div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    mElecTorque = (mPsimd*mIq - mPsimq*mId);</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    mOmMech = mOmMech + mTimeStep * (1. / (2. * mInertia) * (mElecTorque - mMechTorque));</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    mThetaMech = mThetaMech + mTimeStep * (mOmMech* mBase_OmMech);</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160; </div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    <span class="comment">// Calculate equivalent Resistance and current source</span></div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    mVabc &lt;&lt;</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;        mVa,</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;        mVb,</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;        mVc;</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160; </div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    mIabc &lt;&lt;</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;        mIa,</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;        mIb,</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;        mIc;</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160; </div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    mEsh_vbr = (mResistanceMat - (2 / (mTimeStep*mBase_OmElec))*mDInductanceMat)*mIabc + mDVabc - mVabc;</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160; </div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    CalculateL();</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160; </div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    mPsikq1kq2 &lt;&lt;</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;        mPsikq1,</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;        mPsikq2;</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    mPsifdkd &lt;&lt;</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;        mPsifd,</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;        mPsikd;</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160; </div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    CalculateAuxiliarVariables();</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160; </div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    R_eq_vbr = mResistanceMat + (2 / (mTimeStep*mBase_OmElec))*mDInductanceMat + K;</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    E_eq_vbr = mEsh_vbr + E_r_vbr;</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160; </div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    mConductanceMat = (R_eq_vbr*mBase_Z).inverse();</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    mISourceEq = R_eq_vbr.inverse()*E_eq_vbr*mBase_I;</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;}</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160; </div>
<div class="line"><a name="l00349"></a><span class="lineno"><a class="line" href="class_c_p_s_1_1_e_m_t_1_1_ph3_1_1_synchron_generator_v_b_r.html#a7f4f8b66c66ec397e69b16a0c60f0b0e">  349</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_p_s_1_1_e_m_t_1_1_ph3_1_1_synchron_generator_v_b_r.html#a7f4f8b66c66ec397e69b16a0c60f0b0e">EMT::Ph3::SynchronGeneratorVBR::mnaPostStep</a>(Real time, Int timeStepCount, <a class="code" href="class_c_p_s_1_1_attribute.html">Attribute&lt;Matrix&gt;::Ptr</a> &amp;leftVector) {</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    <span class="keywordflow">if</span> ( terminalNotGrounded(0) ) {</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;        mVa = Math::realFromVectorElement(*leftVector, matrixNodeIndex(0,0)) / mBase_V;</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;        mVb = Math::realFromVectorElement(*leftVector, matrixNodeIndex(0,1)) / mBase_V;</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;        mVc = Math::realFromVectorElement(*leftVector, matrixNodeIndex(0,2)) / mBase_V;</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;        mVa = 0;</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;        mVb = 0;</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;        mVc = 0;</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    }</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160; </div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    <span class="comment">// ################ Update machine stator and rotor variables ############################</span></div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    mVabc &lt;&lt;</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;        mVa,</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;        mVb,</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;        mVc;</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160; </div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    mVq = parkTransform(mThetaMech, mVa, mVb, mVc)(0);</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    mVd = parkTransform(mThetaMech, mVa, mVb, mVc)(1);</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    mV0 = parkTransform(mThetaMech, mVa, mVb, mVc)(2);</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160; </div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;<span class="comment">    if (WithExciter == true) {</span></div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;<span class="comment">        mVfd = mExciter.step(mVd, mVq, 1, mTimeStep);</span></div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;<span class="comment">    }*/</span></div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160; </div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    mIabc = R_eq_vbr.inverse()*(mVabc - E_eq_vbr);</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160; </div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    mIa = mIabc(0);</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    mIb = mIabc(1);</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    mIc = mIabc(2);</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160; </div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    mIq_hist = mIq;</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    mId_hist = mId;</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160; </div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    mIq = parkTransform(mThetaMech, mIa, mIb, mIc)(0);</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    mId = parkTransform(mThetaMech, mIa, mIb, mIc)(1);</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    mI0 = parkTransform(mThetaMech, mIa, mIb, mIc)(2);</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160; </div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    <span class="comment">// Calculate rotor flux likanges</span></div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;    <span class="keywordflow">if</span> (mNumDampingWindings == 2) {</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;        mDqStatorCurrents &lt;&lt;</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;            mIq,</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;            mId;</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160; </div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;        mPsikq1kq2 = E1*mIq + E2*mPsikq1kq2 + E1*mIq_hist;</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;        mPsifdkd = F1*mId + F2*mPsifdkd + F1*mId_hist + F3*mVfd;</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160; </div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;        mPsikq1 = mPsikq1kq2(0);</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;        mPsikq2 = mPsikq1kq2(1);</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;        mPsifd = mPsifdkd(0);</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;        mPsikd = mPsifdkd(1);</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160; </div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    }</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160; </div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;        mDqStatorCurrents &lt;&lt;</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;            mIq,</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;            mId;</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160; </div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;        mPsikq1 = E1_1d*mIq + E2_1d*mPsikq1 + E1_1d*mIq_hist;</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;        mPsifdkd = F1*mId + F2*mPsifdkd + F1*mId_hist + F3*mVfd;</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160; </div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;        mPsifd = mPsifdkd(0);</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;        mPsikd = mPsifdkd(1);</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    }</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160; </div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160; </div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;    <span class="comment">// Calculate dynamic flux likages</span></div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;    <span class="keywordflow">if</span> (mNumDampingWindings == 2) {</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;        mPsimq = mDLmq*(mPsikq1 / mLlkq1 + mPsikq2 / mLlkq2 + mIq);</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;    }</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;        mPsimq = mDLmq*(mPsikq1 / mLlkq1 + mIq);</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    }</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160; </div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    mPsimd = mDLmd*(mPsifd / mLlfd + mPsikd / mLlkd + mId);</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160; </div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    K1K2 &lt;&lt; K1, K2;</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    mDVqd = K1K2*mDqStatorCurrents + h_qdr;</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    mDVq = mDVqd(0);</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    mDVd = mDVqd(1);</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160; </div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    mDVa = inverseParkTransform(mThetaMech, mDVq, mDVd, 0)(0);</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    mDVb = inverseParkTransform(mThetaMech, mDVq, mDVd, 0)(1);</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    mDVc = inverseParkTransform(mThetaMech, mDVq, mDVd, 0)(2);</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    mDVabc &lt;&lt;</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;        mDVa,</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;        mDVb,</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;        mDVc;</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160; </div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    mIntfVoltage = mVabc*mBase_V;</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    mIntfCurrent = mIabc*mBase_I;</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;}</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160; </div>
<div class="line"><a name="l00444"></a><span class="lineno"><a class="line" href="class_c_p_s_1_1_e_m_t_1_1_ph3_1_1_synchron_generator_v_b_r.html#a889706e6cdee753a1986808de2489c16">  444</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_p_s_1_1_e_m_t_1_1_ph3_1_1_synchron_generator_v_b_r.html#a889706e6cdee753a1986808de2489c16">EMT::Ph3::SynchronGeneratorVBR::mnaAddPostStepDependencies</a>(AttributeBase::List &amp;prevStepDependencies, AttributeBase::List &amp;attributeDependencies, AttributeBase::List &amp;modifiedAttributes, <a class="code" href="class_c_p_s_1_1_attribute.html">Attribute&lt;Matrix&gt;::Ptr</a> &amp;leftVector) {</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    <span class="comment">// add post-step dependencies of component itself</span></div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    attributeDependencies.push_back(leftVector);</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    modifiedAttributes.push_back(attribute(<span class="stringliteral">&quot;v_intf&quot;</span>));</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    modifiedAttributes.push_back(attribute(<span class="stringliteral">&quot;i_intf&quot;</span>));</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;}</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160; </div>
<div class="line"><a name="l00451"></a><span class="lineno"><a class="line" href="class_c_p_s_1_1_e_m_t_1_1_ph3_1_1_synchron_generator_v_b_r.html#af8fd6b77ae3390027a8467ee1fc3f40c">  451</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_c_p_s_1_1_e_m_t_1_1_ph3_1_1_synchron_generator_v_b_r.html#af8fd6b77ae3390027a8467ee1fc3f40c">EMT::Ph3::SynchronGeneratorVBR::CalculateL</a>() {</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    mDInductanceMat &lt;&lt;</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;        mLl + mLa - mLb*cos(2 * mThetaMech), -mLa / 2 - mLb*cos(2 * mThetaMech - 2 * PI / 3), -mLa / 2 - mLb*cos(2 * mThetaMech + 2 * PI / 3),</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;        -mLa / 2 - mLb*cos(2 * mThetaMech - 2 * PI / 3), mLl + mLa - mLb*cos(2 * mThetaMech - 4 * PI / 3), -mLa / 2 - mLb*cos(2 * mThetaMech),</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;        -mLa / 2 - mLb*cos(2 * mThetaMech + 2 * PI / 3), -mLa / 2 - mLb*cos(2 * mThetaMech), mLl + mLa - mLb*cos(2 * mThetaMech + 4 * PI / 3);</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;}</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160; </div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;<span class="keywordtype">void</span> EMT::Ph3::SynchronGeneratorVBR::CalculateAuxiliarConstants(Real dt) {</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160; </div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    b11 = (mRkq1 / mLlkq1)*(mDLmq / mLlkq1 - 1);</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;    b13 = mRkq1*mDLmq / mLlkq1;</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;    b31 = (mRfd / mLlfd)*(mDLmd / mLlfd - 1);</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    b32 = mRfd*mDLmd / (mLlfd*mLlkd);</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;    b33 = mRfd*mDLmd / mLlfd;</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    b41 = mRkd*mDLmd / (mLlfd*mLlkd);</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    b42 = (mRkd / mLlkd)*(mDLmd / mLlkd - 1);</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;    b43 = mRkd*mDLmd / mLlkd;</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160; </div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    c23 = mDLmd*mRfd / (mLlfd*mLlfd)*(mDLmd / mLlfd - 1) + mDLmd*mDLmd*mRkd / (mLlkd*mLlkd*mLlfd);</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    c24 = mDLmd*mRkd / (mLlkd*mLlkd)*(mDLmd / mLlkd - 1) + mDLmd*mDLmd*mRfd / (mLlfd*mLlfd*mLlkd);</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    c25 = (mRfd / (mLlfd*mLlfd) + mRkd / (mLlkd*mLlkd))*mDLmd*mDLmd;</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    c26 = mDLmd / mLlfd;</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160; </div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    <span class="keywordflow">if</span> (mNumDampingWindings == 2) {</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;        b12 = mRkq1*mDLmq / (mLlkq1*mLlkq2);</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;        b21 = mRkq2*mDLmq / (mLlkq1*mLlkq2);</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;        b22 = (mRkq2 / mLlkq2)*(mDLmq / mLlkq2 - 1);</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;        b23 = mRkq2*mDLmq / mLlkq2;</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;        c11 = mDLmq*mRkq1 / (mLlkq1*mLlkq1)*(mDLmq / mLlkq1 - 1) + mDLmq*mDLmq*mRkq2 / (mLlkq2*mLlkq2*mLlkq1);</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;        c12 = mDLmq*mRkq2 / (mLlkq2*mLlkq2)*(mDLmq / mLlkq2 - 1) + mDLmq*mDLmq*mRkq1 / (mLlkq1*mLlkq1*mLlkq2);</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;        c15 = (mRkq1 / (mLlkq1*mLlkq1) + mRkq2 / (mLlkq2*mLlkq2))*mDLmq*mDLmq;</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160; </div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;        Ea &lt;&lt;</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;            2 - dt*b11, -dt*b12,</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;            -dt*b21, 2 - dt*b22;</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;        E1b &lt;&lt;</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;            dt*b13,</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;            dt*b23;</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;        E1 = Ea.inverse() * E1b;</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160; </div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;        E2b &lt;&lt;</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;            2 + dt*b11, dt*b12,</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;            dt*b21, 2 + dt*b22;</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;        E2 = Ea.inverse() * E2b;</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    }</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;        c11 = mDLmq*mRkq1 / (mLlkq1*mLlkq1)*(mDLmq / mLlkq1 - 1);</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;        c15 = (mRkq1 / (mLlkq1*mLlkq1))*mDLmq*mDLmq;</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160; </div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;        E1_1d = (1 / (2 - dt*b11))*dt*b13;</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;        E2_1d = (1 / (2 - dt*b11))*(2 + dt*b11);</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    }</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160; </div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    Fa &lt;&lt;</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;        2 - dt*b31, -dt*b32,</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;        -dt*b41, 2 - dt*b42;</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    F1b &lt;&lt;</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;        dt*b33,</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;        dt*b43;</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;    F1 = Fa.inverse() * F1b;</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160; </div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    F2b &lt;&lt;</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;        2 + dt*b31, dt*b32,</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;        dt*b41, 2 + dt*b42;</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160; </div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    F2 = Fa.inverse() * F2b;</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160; </div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;    F3b &lt;&lt;</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;        2 * dt,</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;        0;</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    F3 = Fa.inverse()* F3b;</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160; </div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;    C26 &lt;&lt;</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;        0,</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;        c26;</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;}</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160; </div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;<span class="keywordtype">void</span> EMT::Ph3::SynchronGeneratorVBR::CalculateAuxiliarVariables() {</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160; </div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;    <span class="keywordflow">if</span> (mNumDampingWindings == 2) {</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;        c21_omega = -mOmMech*mDLmq / mLlkq1;</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;        c22_omega = -mOmMech*mDLmq / mLlkq2;</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;        c13_omega = mOmMech*mDLmd / mLlfd;</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;        c14_omega = mOmMech*mDLmd / mLlkd;</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160; </div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;        K1a &lt;&lt;</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;            c11, c12,</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;            c21_omega, c22_omega;</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;        K1b &lt;&lt;</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;            c15,</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;            0;</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;        K1 = K1a*E1 + K1b;</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;    }</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;    <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;        c21_omega = -mOmMech*mDLmq / mLlkq1;</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;        c13_omega = mOmMech*mDLmd / mLlfd;</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;        c14_omega = mOmMech*mDLmd / mLlkd;</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160; </div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;        K1a &lt;&lt;</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;            c11,</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;            c21_omega;</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;        K1b &lt;&lt;</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;            c15,</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;            0;</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;        K1 = K1a*E1_1d + K1b;</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    }</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160; </div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    K2a &lt;&lt;</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;        c13_omega, c14_omega,</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;        c23, c24;</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;    K2b &lt;&lt;</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;        0,</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;        c25;</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;    K2 = K2a*F1 + K2b;</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160; </div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;    K &lt;&lt;</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;        K1, K2, Matrix::Zero(2, 1),</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;        0, 0, 0;</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160; </div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;    mKrs_teta &lt;&lt;</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;        2. / 3. * cos(mThetaMech), 2. / 3. * cos(mThetaMech - 2. * M_PI / 3.), 2. / 3. * cos(mThetaMech + 2. * M_PI / 3.),</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;        2. / 3. * sin(mThetaMech), 2. / 3. * sin(mThetaMech - 2. * M_PI / 3.), 2. / 3. * sin(mThetaMech + 2. * M_PI / 3.),</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;        1. / 3., 1. / 3., 1. / 3.;</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160; </div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;    mKrs_teta_inv &lt;&lt;</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;        cos(mThetaMech), sin(mThetaMech), 1.,</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;        cos(mThetaMech - 2. * M_PI / 3.), sin(mThetaMech - 2. * M_PI / 3.), 1,</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;        cos(mThetaMech + 2. * M_PI / 3.), sin(mThetaMech + 2. * M_PI / 3.), 1.;</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160; </div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;    K = mKrs_teta_inv*K*mKrs_teta;</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160; </div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;    <span class="keywordflow">if</span> (mNumDampingWindings == 2)</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;        h_qdr = K1a*E2*mPsikq1kq2 + K1a*E1*mIq + K2a*F2*mPsifdkd + K2a*F1*mId + (K2a*F3 + C26)*mVfd;</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;        h_qdr = K1a*E2_1d*mPsikq1 + K1a*E1_1d*mIq + K2a*F2*mPsifdkd + K2a*F1*mId + (K2a*F3 + C26)*mVfd;</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160; </div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    H_qdr &lt;&lt; h_qdr,</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;        0;</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160; </div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;    E_r_vbr = mKrs_teta_inv*H_qdr;</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;}</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160; </div>
<div class="line"><a name="l00593"></a><span class="lineno"><a class="line" href="class_c_p_s_1_1_e_m_t_1_1_ph3_1_1_synchron_generator_v_b_r.html#ac187458b924beaac90cc105166a7d7d6">  593</a></span>&#160;Matrix <a class="code" href="class_c_p_s_1_1_e_m_t_1_1_ph3_1_1_synchron_generator_v_b_r.html#ac187458b924beaac90cc105166a7d7d6">EMT::Ph3::SynchronGeneratorVBR::parkTransform</a>(Real theta, Real a, Real b, Real c) {</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160; </div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;    Matrix dq0vector(3, 1);</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160; </div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    Real q, d, zero;</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160; </div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;    q = 2. / 3. * cos(theta)*a + 2. / 3. * cos(theta - 2. * M_PI / 3.)*b + 2. / 3. * cos(theta + 2. * M_PI / 3.)*c;</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    d = 2. / 3. * sin(theta)*a + 2. / 3. * sin(theta - 2. * M_PI / 3.)*b + 2. / 3. * sin(theta + 2. * M_PI / 3.)*c;</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;    zero = 1. / 3.*a + 1. / 3.*b + 1. / 3.*c;</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160; </div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;    dq0vector &lt;&lt; q,</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;        d,</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;        zero;</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160; </div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;    <span class="keywordflow">return</span> dq0vector;</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;}</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160; </div>
<div class="line"><a name="l00610"></a><span class="lineno"><a class="line" href="class_c_p_s_1_1_e_m_t_1_1_ph3_1_1_synchron_generator_v_b_r.html#a8eedde8742359fac3ed8a9a72f18cf98">  610</a></span>&#160;Matrix <a class="code" href="class_c_p_s_1_1_e_m_t_1_1_ph3_1_1_synchron_generator_v_b_r.html#a8eedde8742359fac3ed8a9a72f18cf98">EMT::Ph3::SynchronGeneratorVBR::inverseParkTransform</a>(Real theta, Real q, Real d, Real zero) {</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160; </div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;    Matrix abcVector(3, 1);</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160; </div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    Real a, b, c;</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160; </div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;    a = cos(theta)*q + sin(theta)*d + 1.*zero;</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;    b = cos(theta - 2. * M_PI / 3.)*q + sin(theta - 2. * M_PI / 3.)*d + 1.*zero;</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;    c = cos(theta + 2. * M_PI / 3.)*q + sin(theta + 2. * M_PI / 3.)*d + 1.*zero;</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160; </div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;    abcVector &lt;&lt; a,</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;        b,</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;        c;</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160; </div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;    <span class="keywordflow">return</span> abcVector;</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;}</div>
<div class="ttc" id="aclass_c_p_s_1_1_attribute_html"><div class="ttname"><a href="class_c_p_s_1_1_attribute.html">CPS::Attribute</a></div><div class="ttdef"><b>Definition:</b> <a href="_attribute_8h_source.html#l00099">Attribute.h:101</a></div></div>
<div class="ttc" id="aclass_c_p_s_1_1_base_1_1_synchron_generator_html_a0131de687f070c11ca16705c36c78ad0"><div class="ttname"><a href="class_c_p_s_1_1_base_1_1_synchron_generator.html#a0131de687f070c11ca16705c36c78ad0">CPS::Base::SynchronGenerator::mRs</a></div><div class="ttdeci">Real mRs</div><div class="ttdoc">stator resistance Rs [Ohm]</div><div class="ttdef"><b>Definition:</b> <a href="_base___synchron_generator_8h_source.html#l00066">Base_SynchronGenerator.h:66</a></div></div>
<div class="ttc" id="aclass_c_p_s_1_1_base_1_1_synchron_generator_html_a1990c4c829f7a336ab21e1ef856415b8"><div class="ttname"><a href="class_c_p_s_1_1_base_1_1_synchron_generator.html#a1990c4c829f7a336ab21e1ef856415b8">CPS::Base::SynchronGenerator::mLl</a></div><div class="ttdeci">Real mLl</div><div class="ttdoc">leakage inductance Ll [H]</div><div class="ttdef"><b>Definition:</b> <a href="_base___synchron_generator_8h_source.html#l00068">Base_SynchronGenerator.h:68</a></div></div>
<div class="ttc" id="aclass_c_p_s_1_1_base_1_1_synchron_generator_html_a7832f483d62475baad29a452d40d84a0"><div class="ttname"><a href="class_c_p_s_1_1_base_1_1_synchron_generator.html#a7832f483d62475baad29a452d40d84a0">CPS::Base::SynchronGenerator::mTd0_s</a></div><div class="ttdeci">Real mTd0_s</div><div class="ttdoc">Subtransient time constant of d-axis [s].</div><div class="ttdef"><b>Definition:</b> <a href="_base___synchron_generator_8h_source.html#l00118">Base_SynchronGenerator.h:118</a></div></div>
<div class="ttc" id="aclass_c_p_s_1_1_base_1_1_synchron_generator_html_a7a0d4f28acac80c5df24e96cace9d6e6"><div class="ttname"><a href="class_c_p_s_1_1_base_1_1_synchron_generator.html#a7a0d4f28acac80c5df24e96cace9d6e6">CPS::Base::SynchronGenerator::mLq_s</a></div><div class="ttdeci">Real mLq_s</div><div class="ttdoc">Subtransient q-axis inductance [H].</div><div class="ttdef"><b>Definition:</b> <a href="_base___synchron_generator_8h_source.html#l00112">Base_SynchronGenerator.h:112</a></div></div>
<div class="ttc" id="aclass_c_p_s_1_1_base_1_1_synchron_generator_html_a8384c3c3a5ec8e8f9b142591b4616404"><div class="ttname"><a href="class_c_p_s_1_1_base_1_1_synchron_generator.html#a8384c3c3a5ec8e8f9b142591b4616404">CPS::Base::SynchronGenerator::mLd</a></div><div class="ttdeci">Real mLd</div><div class="ttdoc">d-axis inductance Ld [H]</div><div class="ttdef"><b>Definition:</b> <a href="_base___synchron_generator_8h_source.html#l00072">Base_SynchronGenerator.h:72</a></div></div>
<div class="ttc" id="aclass_c_p_s_1_1_base_1_1_synchron_generator_html_a8c650f148ffedc2f4396f6f4cb010217"><div class="ttname"><a href="class_c_p_s_1_1_base_1_1_synchron_generator.html#a8c650f148ffedc2f4396f6f4cb010217">CPS::Base::SynchronGenerator::mOmMech</a></div><div class="ttdeci">Real mOmMech</div><div class="ttdoc">rotor speed omega_r</div><div class="ttdef"><b>Definition:</b> <a href="_base___synchron_generator_8h_source.html#l00168">Base_SynchronGenerator.h:168</a></div></div>
<div class="ttc" id="aclass_c_p_s_1_1_base_1_1_synchron_generator_html_a8d4962c6494e6b5fe9d924c1f83e3f94"><div class="ttname"><a href="class_c_p_s_1_1_base_1_1_synchron_generator.html#a8d4962c6494e6b5fe9d924c1f83e3f94">CPS::Base::SynchronGenerator::mLd_t</a></div><div class="ttdeci">Real mLd_t</div><div class="ttdoc">Transient d-axis inductance [H].</div><div class="ttdef"><b>Definition:</b> <a href="_base___synchron_generator_8h_source.html#l00106">Base_SynchronGenerator.h:106</a></div></div>
<div class="ttc" id="aclass_c_p_s_1_1_base_1_1_synchron_generator_html_a9ac3b83196f52f4014e8476485b38f60"><div class="ttname"><a href="class_c_p_s_1_1_base_1_1_synchron_generator.html#a9ac3b83196f52f4014e8476485b38f60">CPS::Base::SynchronGenerator::setBaseAndFundamentalPerUnitParameters</a></div><div class="ttdeci">void setBaseAndFundamentalPerUnitParameters(Real nomPower, Real nomVolt, Real nomFreq, Real nomFieldCur, Int poleNumber, Real Rs, Real Ll, Real Lmd, Real Lmq, Real Rfd, Real Llfd, Real Rkd, Real Llkd, Real Rkq1, Real Llkq1, Real Rkq2, Real Llkq2, Real inertia)</div><div class="ttdoc">Initializes the base and fundamental machine parameters in per unit.</div><div class="ttdef"><b>Definition:</b> <a href="_base___synchron_generator_8cpp_source.html#l00039">Base_SynchronGenerator.cpp:39</a></div></div>
<div class="ttc" id="aclass_c_p_s_1_1_base_1_1_synchron_generator_html_aa53d7a62e020b76e38dbd047e2a7847d"><div class="ttname"><a href="class_c_p_s_1_1_base_1_1_synchron_generator.html#aa53d7a62e020b76e38dbd047e2a7847d">CPS::Base::SynchronGenerator::mMechTorque</a></div><div class="ttdeci">Real mMechTorque</div><div class="ttdoc">mechanical torque</div><div class="ttdef"><b>Definition:</b> <a href="_base___synchron_generator_8h_source.html#l00176">Base_SynchronGenerator.h:176</a></div></div>
<div class="ttc" id="aclass_c_p_s_1_1_base_1_1_synchron_generator_html_aa8b744d3e00c276a53dd7936cbc1e494"><div class="ttname"><a href="class_c_p_s_1_1_base_1_1_synchron_generator.html#aa8b744d3e00c276a53dd7936cbc1e494">CPS::Base::SynchronGenerator::mDelta</a></div><div class="ttdeci">Real mDelta</div><div class="ttdoc">rotor angle delta</div><div class="ttdef"><b>Definition:</b> <a href="_base___synchron_generator_8h_source.html#l00172">Base_SynchronGenerator.h:172</a></div></div>
<div class="ttc" id="aclass_c_p_s_1_1_base_1_1_synchron_generator_html_aaf2f8a4f1ca955da34b72479fed773c4"><div class="ttname"><a href="class_c_p_s_1_1_base_1_1_synchron_generator.html#aaf2f8a4f1ca955da34b72479fed773c4">CPS::Base::SynchronGenerator::mLq_t</a></div><div class="ttdeci">Real mLq_t</div><div class="ttdoc">Transient q-axis inductance [H].</div><div class="ttdef"><b>Definition:</b> <a href="_base___synchron_generator_8h_source.html#l00108">Base_SynchronGenerator.h:108</a></div></div>
<div class="ttc" id="aclass_c_p_s_1_1_base_1_1_synchron_generator_html_ac5b6c51176c2caa4b27defdcf2b621ca"><div class="ttname"><a href="class_c_p_s_1_1_base_1_1_synchron_generator.html#ac5b6c51176c2caa4b27defdcf2b621ca">CPS::Base::SynchronGenerator::mTq0_t</a></div><div class="ttdeci">Real mTq0_t</div><div class="ttdoc">Transient time constant of q-axis [s].</div><div class="ttdef"><b>Definition:</b> <a href="_base___synchron_generator_8h_source.html#l00116">Base_SynchronGenerator.h:116</a></div></div>
<div class="ttc" id="aclass_c_p_s_1_1_base_1_1_synchron_generator_html_acc1f4ae7a27b9b7e1a913666538ec827"><div class="ttname"><a href="class_c_p_s_1_1_base_1_1_synchron_generator.html#acc1f4ae7a27b9b7e1a913666538ec827">CPS::Base::SynchronGenerator::mLd_s</a></div><div class="ttdeci">Real mLd_s</div><div class="ttdoc">Subtransient d-axis inductance [H].</div><div class="ttdef"><b>Definition:</b> <a href="_base___synchron_generator_8h_source.html#l00110">Base_SynchronGenerator.h:110</a></div></div>
<div class="ttc" id="aclass_c_p_s_1_1_base_1_1_synchron_generator_html_ada5852c6a374ccc5fde46251aa6a33fd"><div class="ttname"><a href="class_c_p_s_1_1_base_1_1_synchron_generator.html#ada5852c6a374ccc5fde46251aa6a33fd">CPS::Base::SynchronGenerator::mTq0_s</a></div><div class="ttdeci">Real mTq0_s</div><div class="ttdoc">Subtransient time constant of q-axis [s].</div><div class="ttdef"><b>Definition:</b> <a href="_base___synchron_generator_8h_source.html#l00120">Base_SynchronGenerator.h:120</a></div></div>
<div class="ttc" id="aclass_c_p_s_1_1_base_1_1_synchron_generator_html_add6ca785d0bfbf120ffc5be2c60545b6"><div class="ttname"><a href="class_c_p_s_1_1_base_1_1_synchron_generator.html#add6ca785d0bfbf120ffc5be2c60545b6">CPS::Base::SynchronGenerator::setBaseAndOperationalPerUnitParameters</a></div><div class="ttdeci">void setBaseAndOperationalPerUnitParameters(Real nomPower, Real nomVolt, Real nomFreq, Int poleNumber, Real nomFieldCur, Real Rs, Real Ld, Real Lq, Real Ld_t, Real Lq_t, Real Ld_s, Real Lq_s, Real Ll, Real Td0_t, Real Tq0_t, Real Td0_s, Real Tq0_s, Real inertia)</div><div class="ttdef"><b>Definition:</b> <a href="_base___synchron_generator_8cpp_source.html#l00052">Base_SynchronGenerator.cpp:52</a></div></div>
<div class="ttc" id="aclass_c_p_s_1_1_base_1_1_synchron_generator_html_aeff43e395455097872843d8cac5fb12f"><div class="ttname"><a href="class_c_p_s_1_1_base_1_1_synchron_generator.html#aeff43e395455097872843d8cac5fb12f">CPS::Base::SynchronGenerator::mElecTorque</a></div><div class="ttdeci">Real mElecTorque</div><div class="ttdoc">electrical torque</div><div class="ttdef"><b>Definition:</b> <a href="_base___synchron_generator_8h_source.html#l00182">Base_SynchronGenerator.h:182</a></div></div>
<div class="ttc" id="aclass_c_p_s_1_1_base_1_1_synchron_generator_html_afe1e370e0f7fc0c592e27ab2590ce966"><div class="ttname"><a href="class_c_p_s_1_1_base_1_1_synchron_generator.html#afe1e370e0f7fc0c592e27ab2590ce966">CPS::Base::SynchronGenerator::mTd0_t</a></div><div class="ttdeci">Real mTd0_t</div><div class="ttdoc">Transient time constant of d-axis [s].</div><div class="ttdef"><b>Definition:</b> <a href="_base___synchron_generator_8h_source.html#l00114">Base_SynchronGenerator.h:114</a></div></div>
<div class="ttc" id="aclass_c_p_s_1_1_base_1_1_synchron_generator_html_affddef77e865aefe796c44cd44f599e1"><div class="ttname"><a href="class_c_p_s_1_1_base_1_1_synchron_generator.html#affddef77e865aefe796c44cd44f599e1">CPS::Base::SynchronGenerator::mLq</a></div><div class="ttdeci">Real mLq</div><div class="ttdoc">q-axis inductance Lq [H]</div><div class="ttdef"><b>Definition:</b> <a href="_base___synchron_generator_8h_source.html#l00076">Base_SynchronGenerator.h:76</a></div></div>
<div class="ttc" id="aclass_c_p_s_1_1_e_m_t_1_1_ph3_1_1_synchron_generator_v_b_r_html"><div class="ttname"><a href="class_c_p_s_1_1_e_m_t_1_1_ph3_1_1_synchron_generator_v_b_r.html">CPS::EMT::Ph3::SynchronGeneratorVBR</a></div><div class="ttdef"><b>Definition:</b> <a href="_e_m_t___ph3___synchron_generator_v_b_r_8h_source.html#l00029">EMT_Ph3_SynchronGeneratorVBR.h:34</a></div></div>
<div class="ttc" id="aclass_c_p_s_1_1_e_m_t_1_1_ph3_1_1_synchron_generator_v_b_r_html_a1416089cf28f20454f387b89cb7c3327"><div class="ttname"><a href="class_c_p_s_1_1_e_m_t_1_1_ph3_1_1_synchron_generator_v_b_r.html#a1416089cf28f20454f387b89cb7c3327">CPS::EMT::Ph3::SynchronGeneratorVBR::SynchronGeneratorVBR</a></div><div class="ttdeci">SynchronGeneratorVBR(String name, String uid, Logger::Level logLevel=Logger::Level::off)</div><div class="ttdoc">Defines UID, name and logging level.</div><div class="ttdef"><b>Definition:</b> <a href="_e_m_t___ph3___synchron_generator_v_b_r_8cpp_source.html#l00016">EMT_Ph3_SynchronGeneratorVBR.cpp:16</a></div></div>
<div class="ttc" id="aclass_c_p_s_1_1_e_m_t_1_1_ph3_1_1_synchron_generator_v_b_r_html_a1ad23099a58fc61b4b5729288f27ee51"><div class="ttname"><a href="class_c_p_s_1_1_e_m_t_1_1_ph3_1_1_synchron_generator_v_b_r.html#a1ad23099a58fc61b4b5729288f27ee51">CPS::EMT::Ph3::SynchronGeneratorVBR::setBaseAndFundamentalPerUnitParameters</a></div><div class="ttdeci">void setBaseAndFundamentalPerUnitParameters(Real nomPower, Real nomVolt, Real nomFreq, Int poleNumber, Real nomFieldCur, Real Rs, Real Ll, Real Lmd, Real Lmq, Real Rfd, Real Llfd, Real Rkd, Real Llkd, Real Rkq1, Real Llkq1, Real Rkq2, Real Llkq2, Real inertia)</div><div class="ttdoc">Initializes the base and fundamental machine parameters in per unit.</div><div class="ttdef"><b>Definition:</b> <a href="_e_m_t___ph3___synchron_generator_v_b_r_8cpp_source.html#l00079">EMT_Ph3_SynchronGeneratorVBR.cpp:79</a></div></div>
<div class="ttc" id="aclass_c_p_s_1_1_e_m_t_1_1_ph3_1_1_synchron_generator_v_b_r_html_a2a5deb7005c553eb7db3cde55833505a"><div class="ttname"><a href="class_c_p_s_1_1_e_m_t_1_1_ph3_1_1_synchron_generator_v_b_r.html#a2a5deb7005c553eb7db3cde55833505a">CPS::EMT::Ph3::SynchronGeneratorVBR::mnaApplyRightSideVectorStamp</a></div><div class="ttdeci">void mnaApplyRightSideVectorStamp(Matrix &amp;rightVector)</div><div class="ttdoc">Stamps right side (source) vector.</div><div class="ttdef"><b>Definition:</b> <a href="_e_m_t___ph3___synchron_generator_v_b_r_8cpp_source.html#l00298">EMT_Ph3_SynchronGeneratorVBR.cpp:298</a></div></div>
<div class="ttc" id="aclass_c_p_s_1_1_e_m_t_1_1_ph3_1_1_synchron_generator_v_b_r_html_a309eb22ecca3d84d5f19d547a88603af"><div class="ttname"><a href="class_c_p_s_1_1_e_m_t_1_1_ph3_1_1_synchron_generator_v_b_r.html#a309eb22ecca3d84d5f19d547a88603af">CPS::EMT::Ph3::SynchronGeneratorVBR::mnaInitialize</a></div><div class="ttdeci">void mnaInitialize(Real omega, Real timeStep, Attribute&lt; Matrix &gt;::Ptr leftVector)</div><div class="ttdoc">Initializes internal variables of the component.</div><div class="ttdef"><b>Definition:</b> <a href="_e_m_t___ph3___synchron_generator_v_b_r_8cpp_source.html#l00146">EMT_Ph3_SynchronGeneratorVBR.cpp:146</a></div></div>
<div class="ttc" id="aclass_c_p_s_1_1_e_m_t_1_1_ph3_1_1_synchron_generator_v_b_r_html_a312263c67c8cb980dc498cf95b8576ed"><div class="ttname"><a href="class_c_p_s_1_1_e_m_t_1_1_ph3_1_1_synchron_generator_v_b_r.html#a312263c67c8cb980dc498cf95b8576ed">CPS::EMT::Ph3::SynchronGeneratorVBR::mnaApplySystemMatrixStamp</a></div><div class="ttdeci">void mnaApplySystemMatrixStamp(Matrix &amp;systemMatrix)</div><div class="ttdoc">Stamps system matrix.</div><div class="ttdef"><b>Definition:</b> <a href="_e_m_t___ph3___synchron_generator_v_b_r_8cpp_source.html#l00274">EMT_Ph3_SynchronGeneratorVBR.cpp:274</a></div></div>
<div class="ttc" id="aclass_c_p_s_1_1_e_m_t_1_1_ph3_1_1_synchron_generator_v_b_r_html_a328a9aae7c94fc88e3a3b2ed1bce018a"><div class="ttname"><a href="class_c_p_s_1_1_e_m_t_1_1_ph3_1_1_synchron_generator_v_b_r.html#a328a9aae7c94fc88e3a3b2ed1bce018a">CPS::EMT::Ph3::SynchronGeneratorVBR::addGovernor</a></div><div class="ttdeci">void addGovernor(Real Ta, Real Tb, Real Tc, Real Fa, Real Fb, Real Fc, Real K, Real Tsr, Real Tsm, Real Tm_init, Real PmRef)</div><div class="ttdoc">Function to initialize Governor and Turbine.</div><div class="ttdef"><b>Definition:</b> <a href="_e_m_t___ph3___synchron_generator_v_b_r_8cpp_source.html#l00140">EMT_Ph3_SynchronGeneratorVBR.cpp:140</a></div></div>
<div class="ttc" id="aclass_c_p_s_1_1_e_m_t_1_1_ph3_1_1_synchron_generator_v_b_r_html_a4a4715b6aee21d722c24c7e57876aac8"><div class="ttname"><a href="class_c_p_s_1_1_e_m_t_1_1_ph3_1_1_synchron_generator_v_b_r.html#a4a4715b6aee21d722c24c7e57876aac8">CPS::EMT::Ph3::SynchronGeneratorVBR::setBaseAndOperationalPerUnitParameters</a></div><div class="ttdeci">void setBaseAndOperationalPerUnitParameters(Real nomPower, Real nomVolt, Real nomFreq, Int poleNumber, Real nomFieldCur, Real Rs, Real Ld, Real Lq, Real Ld_t, Real Lq_t, Real Ld_s, Real Lq_s, Real Ll, Real Td0_t, Real Tq0_t, Real Td0_s, Real Tq0_s, Real inertia)</div><div class="ttdef"><b>Definition:</b> <a href="_e_m_t___ph3___synchron_generator_v_b_r_8cpp_source.html#l00050">EMT_Ph3_SynchronGeneratorVBR.cpp:50</a></div></div>
<div class="ttc" id="aclass_c_p_s_1_1_e_m_t_1_1_ph3_1_1_synchron_generator_v_b_r_html_a7f4f8b66c66ec397e69b16a0c60f0b0e"><div class="ttname"><a href="class_c_p_s_1_1_e_m_t_1_1_ph3_1_1_synchron_generator_v_b_r.html#a7f4f8b66c66ec397e69b16a0c60f0b0e">CPS::EMT::Ph3::SynchronGeneratorVBR::mnaPostStep</a></div><div class="ttdeci">void mnaPostStep(Real time, Int timeStepCount, Attribute&lt; Matrix &gt;::Ptr &amp;leftVector)</div><div class="ttdoc">MNA post step operations.</div><div class="ttdef"><b>Definition:</b> <a href="_e_m_t___ph3___synchron_generator_v_b_r_8cpp_source.html#l00349">EMT_Ph3_SynchronGeneratorVBR.cpp:349</a></div></div>
<div class="ttc" id="aclass_c_p_s_1_1_e_m_t_1_1_ph3_1_1_synchron_generator_v_b_r_html_a7fad15f34f10e1864ebc45eb4a4e1fe9"><div class="ttname"><a href="class_c_p_s_1_1_e_m_t_1_1_ph3_1_1_synchron_generator_v_b_r.html#a7fad15f34f10e1864ebc45eb4a4e1fe9">CPS::EMT::Ph3::SynchronGeneratorVBR::mnaPreStep</a></div><div class="ttdeci">void mnaPreStep(Real time, Int timeStepCount)</div><div class="ttdoc">MNA pre step operations.</div><div class="ttdef"><b>Definition:</b> <a href="_e_m_t___ph3___synchron_generator_v_b_r_8cpp_source.html#l00269">EMT_Ph3_SynchronGeneratorVBR.cpp:269</a></div></div>
<div class="ttc" id="aclass_c_p_s_1_1_e_m_t_1_1_ph3_1_1_synchron_generator_v_b_r_html_a889706e6cdee753a1986808de2489c16"><div class="ttname"><a href="class_c_p_s_1_1_e_m_t_1_1_ph3_1_1_synchron_generator_v_b_r.html#a889706e6cdee753a1986808de2489c16">CPS::EMT::Ph3::SynchronGeneratorVBR::mnaAddPostStepDependencies</a></div><div class="ttdeci">void mnaAddPostStepDependencies(AttributeBase::List &amp;prevStepDependencies, AttributeBase::List &amp;attributeDependencies, AttributeBase::List &amp;modifiedAttributes, Attribute&lt; Matrix &gt;::Ptr &amp;leftVector)</div><div class="ttdoc">Add MNA post step dependencies.</div><div class="ttdef"><b>Definition:</b> <a href="_e_m_t___ph3___synchron_generator_v_b_r_8cpp_source.html#l00444">EMT_Ph3_SynchronGeneratorVBR.cpp:444</a></div></div>
<div class="ttc" id="aclass_c_p_s_1_1_e_m_t_1_1_ph3_1_1_synchron_generator_v_b_r_html_a8eedde8742359fac3ed8a9a72f18cf98"><div class="ttname"><a href="class_c_p_s_1_1_e_m_t_1_1_ph3_1_1_synchron_generator_v_b_r.html#a8eedde8742359fac3ed8a9a72f18cf98">CPS::EMT::Ph3::SynchronGeneratorVBR::inverseParkTransform</a></div><div class="ttdeci">Matrix inverseParkTransform(Real theta, Real q, Real d, Real zero)</div><div class="ttdoc">Inverse Park transform as described in Krause.</div><div class="ttdef"><b>Definition:</b> <a href="_e_m_t___ph3___synchron_generator_v_b_r_8cpp_source.html#l00610">EMT_Ph3_SynchronGeneratorVBR.cpp:610</a></div></div>
<div class="ttc" id="aclass_c_p_s_1_1_e_m_t_1_1_ph3_1_1_synchron_generator_v_b_r_html_a98ac6b96fbea2f1920f71de9c5bf28a2"><div class="ttname"><a href="class_c_p_s_1_1_e_m_t_1_1_ph3_1_1_synchron_generator_v_b_r.html#a98ac6b96fbea2f1920f71de9c5bf28a2">CPS::EMT::Ph3::SynchronGeneratorVBR::initializeFromNodesAndTerminals</a></div><div class="ttdeci">void initializeFromNodesAndTerminals(Real frequency)</div><div class="ttdoc">Initializes component from power flow data.</div><div class="ttdef"><b>Definition:</b> <a href="_e_m_t___ph3___synchron_generator_v_b_r_8cpp_source.html#l00109">EMT_Ph3_SynchronGeneratorVBR.cpp:109</a></div></div>
<div class="ttc" id="aclass_c_p_s_1_1_e_m_t_1_1_ph3_1_1_synchron_generator_v_b_r_html_ab0945b0c5eba9c6d5dede8f20de6df96"><div class="ttname"><a href="class_c_p_s_1_1_e_m_t_1_1_ph3_1_1_synchron_generator_v_b_r.html#ab0945b0c5eba9c6d5dede8f20de6df96">CPS::EMT::Ph3::SynchronGeneratorVBR::stepInPerUnit</a></div><div class="ttdeci">void stepInPerUnit()</div><div class="ttdef"><b>Definition:</b> <a href="_e_m_t___ph3___synchron_generator_v_b_r_8cpp_source.html#l00306">EMT_Ph3_SynchronGeneratorVBR.cpp:306</a></div></div>
<div class="ttc" id="aclass_c_p_s_1_1_e_m_t_1_1_ph3_1_1_synchron_generator_v_b_r_html_ac187458b924beaac90cc105166a7d7d6"><div class="ttname"><a href="class_c_p_s_1_1_e_m_t_1_1_ph3_1_1_synchron_generator_v_b_r.html#ac187458b924beaac90cc105166a7d7d6">CPS::EMT::Ph3::SynchronGeneratorVBR::parkTransform</a></div><div class="ttdeci">Matrix parkTransform(Real theta, Real a, Real b, Real c)</div><div class="ttdoc">Park transform as described in Krause.</div><div class="ttdef"><b>Definition:</b> <a href="_e_m_t___ph3___synchron_generator_v_b_r_8cpp_source.html#l00593">EMT_Ph3_SynchronGeneratorVBR.cpp:593</a></div></div>
<div class="ttc" id="aclass_c_p_s_1_1_e_m_t_1_1_ph3_1_1_synchron_generator_v_b_r_html_ac67dd7d013f16501da61f46e8f636211"><div class="ttname"><a href="class_c_p_s_1_1_e_m_t_1_1_ph3_1_1_synchron_generator_v_b_r.html#ac67dd7d013f16501da61f46e8f636211">CPS::EMT::Ph3::SynchronGeneratorVBR::setInitialValues</a></div><div class="ttdeci">void setInitialValues(Real initActivePower, Real initReactivePower, Real initTerminalVolt, Real initVoltAngle, Real initMechPower)</div><div class="ttdoc">Initialize states according to desired initial electrical powerflow and mechanical input power.</div><div class="ttdef"><b>Definition:</b> <a href="_e_m_t___ph3___synchron_generator_v_b_r_8cpp_source.html#l00096">EMT_Ph3_SynchronGeneratorVBR.cpp:96</a></div></div>
<div class="ttc" id="aclass_c_p_s_1_1_e_m_t_1_1_ph3_1_1_synchron_generator_v_b_r_html_ad7821b407a1cb359a0a6f2ae4e340e8c"><div class="ttname"><a href="class_c_p_s_1_1_e_m_t_1_1_ph3_1_1_synchron_generator_v_b_r.html#ad7821b407a1cb359a0a6f2ae4e340e8c">CPS::EMT::Ph3::SynchronGeneratorVBR::mnaAddPreStepDependencies</a></div><div class="ttdeci">void mnaAddPreStepDependencies(AttributeBase::List &amp;prevStepDependencies, AttributeBase::List &amp;attributeDependencies, AttributeBase::List &amp;modifiedAttributes)</div><div class="ttdoc">Add MNA pre step dependencies.</div><div class="ttdef"><b>Definition:</b> <a href="_e_m_t___ph3___synchron_generator_v_b_r_8cpp_source.html#l00291">EMT_Ph3_SynchronGeneratorVBR.cpp:291</a></div></div>
<div class="ttc" id="aclass_c_p_s_1_1_e_m_t_1_1_ph3_1_1_synchron_generator_v_b_r_html_af3f87794e24c9c5ebdc20e55ca63fb9b"><div class="ttname"><a href="class_c_p_s_1_1_e_m_t_1_1_ph3_1_1_synchron_generator_v_b_r.html#af3f87794e24c9c5ebdc20e55ca63fb9b">CPS::EMT::Ph3::SynchronGeneratorVBR::addExciter</a></div><div class="ttdeci">void addExciter(Real Ta, Real Ka, Real Te, Real Ke, Real Tf, Real Kf, Real Tr, Real Lad, Real Rfd)</div><div class="ttdoc">Function to initialize Exciter.</div><div class="ttdef"><b>Definition:</b> <a href="_e_m_t___ph3___synchron_generator_v_b_r_8cpp_source.html#l00134">EMT_Ph3_SynchronGeneratorVBR.cpp:134</a></div></div>
<div class="ttc" id="aclass_c_p_s_1_1_e_m_t_1_1_ph3_1_1_synchron_generator_v_b_r_html_af8fd6b77ae3390027a8467ee1fc3f40c"><div class="ttname"><a href="class_c_p_s_1_1_e_m_t_1_1_ph3_1_1_synchron_generator_v_b_r.html#af8fd6b77ae3390027a8467ee1fc3f40c">CPS::EMT::Ph3::SynchronGeneratorVBR::CalculateL</a></div><div class="ttdeci">void CalculateL()</div><div class="ttdoc">Calculate inductance Matrix L and its derivative.</div><div class="ttdef"><b>Definition:</b> <a href="_e_m_t___ph3___synchron_generator_v_b_r_8cpp_source.html#l00451">EMT_Ph3_SynchronGeneratorVBR.cpp:451</a></div></div>
<div class="ttc" id="aclass_c_p_s_1_1_m_n_a_interface_html_a0b282e18a0e1ef7c833b23a7372a9fa7"><div class="ttname"><a href="class_c_p_s_1_1_m_n_a_interface.html#a0b282e18a0e1ef7c833b23a7372a9fa7">CPS::MNAInterface::mnaInitialize</a></div><div class="ttdeci">virtual void mnaInitialize(Real omega, Real timeStep)</div><div class="ttdoc">Initializes variables of components.</div><div class="ttdef"><b>Definition:</b> <a href="_m_n_a_interface_8h_source.html#l00025">MNAInterface.h:25</a></div></div>
<div class="ttc" id="aclass_c_p_s_1_1_sim_power_comp_html"><div class="ttname"><a href="class_c_p_s_1_1_sim_power_comp.html">CPS::SimPowerComp</a></div><div class="ttdoc">Base class for all components that are transmitting power.</div><div class="ttdef"><b>Definition:</b> <a href="_sim_power_comp_8h_source.html#l00018">SimPowerComp.h:18</a></div></div>
<div class="ttc" id="aclass_c_p_s_1_1_sim_power_comp_html_a894f2d211d03df0cffdc797e8a07342d"><div class="ttname"><a href="class_c_p_s_1_1_sim_power_comp.html#a894f2d211d03df0cffdc797e8a07342d">CPS::SimPowerComp&lt; Real &gt;::mIntfVoltage</a></div><div class="ttdeci">MatrixVar&lt; Real &gt; mIntfVoltage</div><div class="ttdoc">Voltage between terminals.</div><div class="ttdef"><b>Definition:</b> <a href="_sim_power_comp_8h_source.html#l00026">SimPowerComp.h:26</a></div></div>
<div class="ttc" id="aclass_c_p_s_1_1_sim_power_comp_html_ac8a46a0ec79c84c3b2bf0617f14f60ee"><div class="ttname"><a href="class_c_p_s_1_1_sim_power_comp.html#ac8a46a0ec79c84c3b2bf0617f14f60ee">CPS::SimPowerComp&lt; Real &gt;::mIntfCurrent</a></div><div class="ttdeci">MatrixVar&lt; Real &gt; mIntfCurrent</div><div class="ttdoc">Current through component.</div><div class="ttdef"><b>Definition:</b> <a href="_sim_power_comp_8h_source.html#l00028">SimPowerComp.h:28</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
